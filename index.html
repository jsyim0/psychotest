<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ (E/S/O/C)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --main-color: #6366f1;
    --bg-light: #eef2ff;
    --bg-dark: #1e293b;
    --text-dark: #111827;
    --text-light: #f8fafc;
  }

  body {
    font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
    background: linear-gradient(120deg, var(--bg-light), #e0e7ff);
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    transition: background 0.5s ease;
  }

  .container {
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 480px;
    padding: 5vw;
    text-align: center;
    animation: fadeIn 0.5s ease;
  }

  h1 {
    font-size: clamp(1.4em, 4vw, 1.8em);
    color: #1e3a8a;
  }

  .btn {
    background: var(--main-color);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: clamp(0.9em, 3vw, 1em);
    cursor: pointer;
    transition: 0.2s;
    width: 100%;
    max-width: 300px;
    margin: 8px auto;
    display: block;
  }
  .btn:hover { background: #4338ca; transform: scale(1.03); }

  .choice {
    background: #f8fafc;
    border-radius: 14px;
    margin: 10px 0;
    padding: 14px 16px;
    cursor: pointer;
    border: 2px solid transparent;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
    transition: all 0.25s ease;
    font-weight: 500;
    font-size: clamp(0.85em, 2.8vw, 1em);
  }
  .choice:hover { transform: scale(1.03); border-color: var(--main-color); background: #eef2ff; }
  .choice.selected { background: linear-gradient(90deg, #6366f1, #a78bfa); color: white; }

  .progress {
    height: 10px; background: #e5e7eb; border-radius: 5px;
    margin: 15px 0;
  }
  .progress-fill {
    height: 100%; background: var(--main-color);
    width: 0%; border-radius: 5px; transition: width 0.3s ease;
  }

  canvas { width: 100% !important; height: auto !important; }

  @media (max-width: 600px) {
    body { padding: 10px; }
    .container { padding: 20px; border-radius: 14px; }
    .choice { padding: 12px; font-size: 0.9em; }
  }

  @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
</style>
</head>
<body>
<div class="container">
  <h1 id="title">ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ (E/S/O/C)</h1>
  <div id="lang-select">
    <select id="lang" onchange="setLang(this.value)">
      <option value="ko">í•œêµ­ì–´</option>
      <option value="en">English</option>
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="fr">FranÃ§ais</option>
      <option value="es">EspaÃ±ol</option>
    </select>
  </div>

  <div id="start-screen">
    <p id="intro">ë‹¹ì‹ ì˜ ì„±í–¥ì„ ê°„ë‹¨íˆ ì•Œì•„ë³´ì„¸ìš”.<br>5ê°œì˜ ì§ˆë¬¸ì— ë‹µí•˜ë©´ ê²°ê³¼ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš”.</p>
    <button class="btn" onclick="startQuiz()">ì‹œì‘í•˜ê¸°</button>
  </div>

  <div id="quiz-screen" class="hidden">
    <div class="progress"><div class="progress-fill" id="progress"></div></div>
    <h3 id="question"></h3>
    <div id="choices"></div>
  </div>

  <div id="result-screen" class="hidden fade">
    <h2 id="result-title">ê²°ê³¼</h2>
    <canvas id="chart"></canvas>
    <h3 id="type"></h3>
    <p id="desc"></p>
    <button class="btn" onclick="restart()">ë‹¤ì‹œí•˜ê¸°</button>
    <button class="btn" onclick="shareResult()">ê³µìœ í•˜ê¸°</button>
  </div>
</div>

<script>
const data = {
  ko: { start:"ì‹œì‘í•˜ê¸°", intro:"ë‹¹ì‹ ì˜ ì„±í–¥ì„ ê°„ë‹¨íˆ ì•Œì•„ë³´ì„¸ìš”.<br>5ê°œì˜ ì§ˆë¬¸ì— ë‹µí•˜ë©´ ê²°ê³¼ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš”.", result:"ê²°ê³¼" },
  en: { start:"Start", intro:"Find out your personality type!<br>Answer 5 short questions.", result:"Result" },
  ja: { start:"é–‹å§‹", intro:"5ã¤ã®è³ªå•ã«ç­”ãˆã¦æ€§æ ¼ã‚¿ã‚¤ãƒ—ã‚’è¨ºæ–­ã—ã¾ã™ã€‚", result:"çµæœ" },
  fr: { start:"Commencer", intro:"RÃ©pondez Ã  5 questions pour dÃ©couvrir votre personnalitÃ©.", result:"RÃ©sultat" },
  es: { start:"Comenzar", intro:"Responde 5 preguntas para conocer tu tipo de personalidad.", result:"Resultado" }
};

let lang="ko";
function setLang(l){ lang=l;
  document.getElementById("intro").innerHTML=data[l].intro;
  document.querySelector("button.btn").innerText=data[l].start;
  document.getElementById("result-title").innerText=data[l].result;
}

const questions=[
  {q:"ì£¼ë§ì— ì¹œêµ¬ë“¤ì´ ì•½ì†ì„ ì¡ìœ¼ë©´ ë‚˜ëŠ”â€¦", c:[["ì ê·¹ì ìœ¼ë¡œ ë‚˜ì„ ë‹¤","E"],["ì¡°ìš©íˆ ì‰°ë‹¤","S"],["ìƒˆë¡œìš´ í™œë™ì„ ì œì•ˆí•œë‹¤","O"],["ì¼ì •ì„ ê¼¼ê¼¼íˆ í™•ì¸í•œë‹¤","C"]]},
  {q:"ë‚¯ì„  ìƒí™©ì—ì„œ ë‚˜ëŠ”â€¦", c:[["ë¨¼ì € ë§ ê±´ë‹¤","E"],["ì¡°ìš©íˆ ì‚´í•€ë‹¤","S"],["ìƒˆë¡œìš´ ì ‘ê·¼ì„ ì‹œë„í•œë‹¤","O"],["ê³„íšì„ ì„¸ìš´ë‹¤","C"]]},
  {q:"ì¼ì„ ì²˜ë¦¬í•  ë•Œ ë‚˜ëŠ”â€¦", c:[["í•¨ê»˜ í•´ê²°","E"],["ì¹¨ì°©í•˜ê²Œ","S"],["ì°½ì˜ì ìœ¼ë¡œ","O"],["ì²´ê³„ì ìœ¼ë¡œ","C"]]},
  {q:"ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ê³ ë¥¼ ë•Œ ë‚˜ëŠ”â€¦", c:[["ì¹œêµ¬ë“¤ê³¼","E"],["ê¾¸ì¤€íˆ í•  ìˆ˜ ìˆëŠ”","S"],["ìƒ‰ë‹¤ë¥¸","O"],["ë°°ìš¸ ìˆ˜ ìˆëŠ”","C"]]},
  {q:"íšŒì˜ì—ì„œ ì˜ê²¬ì„ ë§í•  ë•Œ ë‚˜ëŠ”â€¦", c:[["ë¨¼ì € ë§í•œë‹¤","E"],["ì¡°ìš©íˆ","S"],["ì•„ì´ë””ì–´ë¥¼ ë‚¸ë‹¤","O"],["ê·¼ê±°ë¥¼ ì œì‹œí•œë‹¤","C"]]},
  {q:"ì—¬í–‰ì„ ê³„íší•  ë•Œ ë‚˜ëŠ”â€¦", c:[["í•¨ê»˜ ì¦ê¸¸ ì¼ì •","E"],["í¸ì•ˆí•œ ì¥ì†Œ","S"],["ëª¨í—˜","O"],["ì„¸ë¶€ ì¼ì •","C"]]}
];

let selected=[], index=0, score={E:0,S:0,O:0,C:0}, chart;

function startQuiz(){
  document.getElementById("start-screen").style.display="none";
  document.getElementById("quiz-screen").style.display="block";
  selected=[...questions].sort(()=>Math.random()-0.5).slice(0,5);
  index=0; score={E:0,S:0,O:0,C:0};
  speak("í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.");
  showQuestion();
}

function showQuestion(){
  const q=selected[index];
  document.getElementById("question").innerText=`(${index+1}/5) ${q.q}`;
  const cDiv=document.getElementById("choices"); cDiv.innerHTML="";
  q.c.sort(()=>Math.random()-0.5).forEach(([txt,t])=>{
    const d=document.createElement("div");
    d.className="choice"; d.innerText=txt;
    d.onclick=()=>{ d.classList.add("selected"); setTimeout(()=>select(t),200); };
    cDiv.appendChild(d);
  });
  document.getElementById("progress").style.width=((index)/5)*100+"%";
  speak(q.q);
}

function select(t){ score[t]++; index++; index<selected.length?showQuestion():showResult(); }

function showResult(){
  document.getElementById("quiz-screen").style.display="none";
  document.getElementById("result-screen").style.display="block";
  document.getElementById("progress").style.width="100%";
  const sorted=Object.entries(score).sort((a,b)=>b[1]-a[1]);
  const top=sorted.slice(0,3).map(e=>e[0]).join("");
  document.getElementById("type").innerText=`ë‹¹ì‹ ì˜ ìœ í˜•: ${top}`;
  document.getElementById("desc").innerText=getDesc(top);
  speak(`ë‹¹ì‹ ì˜ ê²°ê³¼ëŠ” ${top} ìœ í˜•ì…ë‹ˆë‹¤. ${getDesc(top)}`);
  const ctx=document.getElementById("chart");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:"bar",data:{labels:["E","S","O","C"],datasets:[{data:["E","S","O","C"].map(t=>score[t]),backgroundColor:["#6366f1","#a78bfa","#60a5fa","#34d399"]}]},options:{scales:{y:{beginAtZero:true}},plugins:{legend:{display:false}}}});
}

function getDesc(type){
  const s=new Set(type);
  if(["E","O","C"].every(x=>s.has(x)))return"ì‚¬êµì ì´ë©° ì°½ì˜ì ì´ê³  ì²´ê³„ì ì¸ ë¦¬ë”í˜•ì…ë‹ˆë‹¤.";
  if(["E","S","C"].every(x=>s.has(x)))return"í˜„ì‹¤ì ì´ë©° ì‹ ë¢°ë°›ëŠ” í˜‘ë ¥ê°€í˜•ì…ë‹ˆë‹¤.";
  if(["E","O"].every(x=>s.has(x)))return"í™œë°œí•˜ê³  ì•„ì´ë””ì–´ê°€ í’ë¶€í•œ íƒí—˜ê°€í˜•ì…ë‹ˆë‹¤.";
  if(["S","C"].every(x=>s.has(x)))return"ì°¨ë¶„í•˜ê³  ì±…ì„ê° ìˆëŠ” ë¶„ì„ê°€í˜•ì…ë‹ˆë‹¤.";
  if(["O","C"].every(x=>s.has(x)))return"ì°½ì˜ì ì´ê³  ê³„íšì ì¸ í˜ì‹ ê°€í˜•ì…ë‹ˆë‹¤.";
  return"ê· í˜• ì¡íŒ ë³µí•©í˜•ì…ë‹ˆë‹¤.";
}

function restart(){
  document.getElementById("result-screen").style.display="none";
  document.getElementById("start-screen").style.display="block";
  if(chart) chart.destroy();
  speak("í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
}

// ğŸ—£ï¸ ìŒì„± ì•ˆë‚´ (ë¯¸ì§€ì› ì‹œ í…ìŠ¤íŠ¸ ì•ˆë‚´)
const isSpeechSupported="speechSynthesis" in window;
function speak(text){
  if(!isSpeechSupported){showVoiceFallback(text);return;}
  window.speechSynthesis.cancel();
  const msg=new SpeechSynthesisUtterance(text);
  msg.lang={ko:"ko-KR",en:"en-US",ja:"ja-JP",fr:"fr-FR",es:"es-ES"}[lang]||"ko-KR";
  msg.rate=1; msg.pitch=1; msg.volume=1;
  window.speechSynthesis.speak(msg);
}
function showVoiceFallback(text){
  const old=document.getElementById("voice-fallback"); if(old) old.remove();
  const box=document.createElement("div");
  box.id="voice-fallback";
  Object.assign(box.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",
  background:"rgba(15,23,42,0.9)",color:"white",padding:"12px 18px",borderRadius:"12px",
  fontSize:"0.9em",zIndex:"9999"});
  box.innerText=`ğŸ”ˆ ìŒì„± ì•ˆë‚´ ë¯¸ì§€ì›: "${text}"`;
  document.body.appendChild(box);
  setTimeout(()=>{box.remove();},3500);
}

// ê³µìœ 
function shareResult(){
  const url=window.location.href;
  const text=document.getElementById("type").innerText;
  if(navigator.share){
    navigator.share({title:"ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ê²°ê³¼",text,url});
  }else{
    navigator.clipboard.writeText(`${text} - ${url}`);
    alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }
}
</script>
</body>
</html>
