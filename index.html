<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ â€” E/S/O/C (ë‹¤êµ­ì–´ + TTS)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --accent:#6366f1;
    --bg:linear-gradient(120deg,#eef2ff,#e0e7ff);
    --card:#fff;
    --maxw:980px;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, "Noto Sans KR", system-ui; margin:0; padding:20px; display:flex; justify-content:center; background:var(--bg)}
  .card{width:100%;max-width:var(--maxw);background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:1.2rem;background:linear-gradient(45deg,#4f46e5,#8b5cf6);-webkit-background-clip:text;color:transparent}
  #headerControls{display:flex;gap:8px;align-items:center}
  select,input,button{font-size:0.95rem;padding:8px 10px;border-radius:8px;border:1px solid #e6e9f2;background:transparent}
  button.btn{background:var(--accent);color:#fff;border:none;cursor:pointer;box-shadow:0 6px 18px rgba(99,102,241,0.12)}
  main{display:flex;gap:16px;flex-wrap:wrap}
  .quiz{flex:1 1 420px;min-width:280px}
  .start-box,.question-card,.result-card{border-radius:12px;padding:14px;background:rgba(255,255,255,0.98);box-shadow:0 6px 18px rgba(2,6,23,0.04)}
  .intro{color:#475569;margin:6px 0 12px;font-size:0.95rem;line-height:1.4}
  .trait-cards{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
  .trait{border-radius:10px;padding:10px;text-align:center;font-size:0.9rem}
  .E{background:#eff6ff;color:#1d4ed8} .S{background:#f0fdf4;color:#15803d}
  .O{background:#fff7ed;color:#c2410c} .C{background:#f5f3ff;color:#6d28d9}
  .progress{height:10px;background:#eef2ff;border-radius:999px;overflow:hidden;margin:10px 0}
  .progress > .fill{height:100%;width:0;background:linear-gradient(90deg,#6366f1,#8b5cf6);transition:width .3s}
  .choices{display:flex;flex-direction:column;gap:10px;margin-top:8px}
  .choice{padding:12px;border-radius:10px;background:#f8fafc;cursor:pointer;border:1px solid transparent;transition:all .15s}
  .choice:hover{transform:translateY(-3px);background:#eef2ff;border-color:rgba(99,102,241,0.12)}
  .visual{width:360px;flex:0 0 360px;min-width:260px;display:flex;flex-direction:column;gap:12px}
  .chart-wrap{border-radius:12px;padding:12px;background:rgba(255,255,255,0.98);height:360px;display:flex;flex-direction:column}
  .small{font-size:0.9rem;color:#64748b}
  @media(max-width:980px){main{flex-direction:column-reverse}.visual{width:100%}}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="ì‹¬ë¦¬í…ŒìŠ¤íŠ¸">
    <header>
      <h1 id="appTitle">ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ â€” E/S/O/C</h1>
      <div id="headerControls">
        <select id="langSelect" aria-label="ì–¸ì–´ ì„ íƒ"></select>
        <button class="btn" id="startBtn">ì‹œì‘</button>
      </div>
    </header>

    <main>
      <!-- quiz column -->
      <section class="quiz" aria-live="polite">
        <div id="startBox" class="start-box">
          <p id="introText" class="intro">ì–¸ì–´ë¥¼ ì„ íƒí•œ ë’¤ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”. ì‹œì‘í•˜ë©´ ì–¸ì–´ ì„ íƒê³¼ ì‹œì‘ ë²„íŠ¼ì€ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.</p>
          <div class="trait-cards" role="list">
            <div class="trait E" role="listitem">ğŸ’¬ <strong>E â€” ì™¸í–¥ì„±</strong><div class="small">ì‚¬ëŒë“¤ê³¼ ì–´ìš¸ë¦¬ë©° ì—ë„ˆì§€ë¥¼ ì–»ëŠ” íƒ€ì…</div></div>
            <div class="trait S" role="listitem">âš–ï¸ <strong>S â€” ì•ˆì •ì„±</strong><div class="small">ì°¨ë¶„í•˜ê³  ê· í˜•ì„ ì¤‘ì‹œí•˜ëŠ” íƒ€ì…</div></div>
            <div class="trait O" role="listitem">ğŸ’¡ <strong>O â€” ê°œë°©ì„±</strong><div class="small">ìƒˆë¡­ê³  ì°½ì˜ì ì¸ ê²ƒì„ ì¦ê¸°ëŠ” íƒ€ì…</div></div>
            <div class="trait C" role="listitem">ğŸ“˜ <strong>C â€” ì„±ì‹¤ì„±</strong><div class="small">ê³„íšì ì´ê³  ì±…ì„ê° ìˆëŠ” íƒ€ì…</div></div>
          </div>
        </div>

        <div id="questionCard" class="question-card" style="display:none; margin-top:12px;">
          <div class="progress"><div class="fill" id="progressFill"></div></div>
          <div id="questionTitle" class="question-title" style="font-weight:700"></div>
          <div class="choices" id="choices" role="list"></div>
        </div>

        <div id="resultCard" class="result-card" style="display:none; margin-top:12px;">
          <h3 id="resultTitle">ê²°ê³¼</h3>
          <p id="resultSummary" class="small"></p>
          <div id="traitDetails" style="margin-top:8px"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn" id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
          </div>
        </div>
      </section>

      <!-- visualization column -->
      <aside class="visual" aria-hidden="false">
        <div class="chart-wrap">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div class="small">ì°¨íŠ¸ (ë ˆì´ë”)</div>
            <div class="small" id="chartHint">ê²°ê³¼ í›„ ìë™ í‘œì‹œ</div>
          </div>
          <div style="flex:1;position:relative;margin-top:8px;">
            <canvas id="resultChart" role="img" aria-label="ê²°ê³¼ ì°¨íŠ¸" style="width:100%;height:100%"></canvas>
          </div>
        </div>
        <div class="small" style="text-align:center">ì•„ì´ì½˜: ğŸ’¬ E Â· âš–ï¸ S Â· ğŸ’¡ O Â· ğŸ“˜ C</div>
      </aside>
    </main>
  </div>

<script>
/* ======================
   ë‹¤êµ­ì–´ ë°ì´í„° (ko/en/ja/fr/es/zh)
   ê° í•­ëª©: ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸, trait ì„¤ëª…, UI í…ìŠ¤íŠ¸
   ====================== */
const DATA = {
  ko: {
    title: "ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ â€” E/S/O/C",
    intro: "ì§ˆë¬¸ì— ë‹µí•˜ë©´ E/S/O/C ì„±í–¥ì„ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.",
    start: "ì‹œì‘", retry: "ë‹¤ì‹œí•˜ê¸°",
    questions: [
      { q:"ì£¼ë§ì— ì¹œêµ¬ë“¤ì´ ì•½ì†ì„ ì¡ì„ ë•Œ, ë‹¹ì‹ ì€ ì–´ë–¤ ë°˜ì‘ì„ ë³´ì´ë‚˜ìš”?", c:[["ë¨¼ì € ì°¸ì—¬ ì˜ì‚¬ë¥¼ ë°íŒë‹¤","E"],["ì¡°ìš©íˆ ì§€ì¼œë³¸ë‹¤","S"],["ìƒˆë¡œìš´ í™œë™ì„ ì œì•ˆí•œë‹¤","O"],["ì¼ì •ì„ ê¼¼ê¼¼íˆ í™•ì¸í•œë‹¤","C"]] },
      { q:"ë‚¯ì„  ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ìˆì„ ë•Œ, ë‹¹ì‹ ì€ ë¬´ì—‡ì„ í•˜ë‚˜ìš”?", c:[["ë¨¼ì € ë§ì„ ê±´ë‹¤","E"],["í•„ìš”í•  ë•Œë§Œ ë§í•œë‹¤","S"],["í¥ë¯¸ìˆëŠ” ì£¼ì œë¥¼ êº¼ë‚¸ë‹¤","O"],["ìƒëŒ€ ë°˜ì‘ì„ ì‚´í•€ë‹¤","C"]] },
      { q:"ìƒˆë¡œìš´ ì¼ì„ ë§¡ì•˜ì„ ë•Œ, ì–´ë–»ê²Œ ì‹œì‘í•˜ë‚˜ìš”?", c:[["ì‚¬ëŒë“¤ê³¼ í˜‘ë ¥í•œë‹¤","E"],["ê³„íšì„ ì„¸ìš´ë‹¤","C"],["ì¦‰í¥ì ìœ¼ë¡œ ì‹œë„í•œë‹¤","O"],["ì§€ì¹¨ì„ ìˆ™ì§€í•œ í›„ ì‹œì‘í•œë‹¤","S"]] },
      { q:"ì—¬í–‰ì„ ì¤€ë¹„í•  ë•Œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?", c:[["ëª¨ë‘ê°€ ì¦ê¸¸ ì¼ì •","E"],["í¸ì•ˆí•œ ìˆ™ì†Œ","S"],["ìƒˆë¡œìš´ ê²½í—˜","O"],["ì„¸ë¶€ ê³„íš","C"]] },
      { q:"ëª¨ì„ì—ì„œ ì˜ê²¬ì´ ê°ˆë¦´ ë•Œ ë‹¹ì‹ ì€?", c:[["ë¶„ìœ„ê¸°ë¥¼ ì´ëŒë©° ì¡°ìœ¨í•œë‹¤","E"],["ì¡°ìš©íˆ íŒë‹¨í•œë‹¤","S"],["ì°½ì˜ì  í•´ê²°ì±…ì„ ì œì‹œí•œë‹¤","O"],["ë…¼ë¦¬ì ìœ¼ë¡œ ê·¼ê±°ë¥¼ ì œì‹œí•œë‹¤","C"]] }
    ],
    traits: {
      E: "ì‚¬êµì ì´ë©° ì‚¬ëŒë“¤ê³¼ ì–´ìš¸ë¦¬ë©´ì„œ ì—ë„ˆì§€ë¥¼ ì–»ëŠ” ìœ í˜•ì…ë‹ˆë‹¤.",
      S: "ì•ˆì •ê³¼ ì‹ ì¤‘í•¨ì„ ì¤‘ìš”ì‹œí•˜ë©° ì°¨ë¶„í•œ ì ‘ê·¼ì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
      O: "ìƒˆë¡œìš´ ê²½í—˜ê³¼ ì•„ì´ë””ì–´ë¥¼ ì¦ê¸°ë©° ì°½ì˜ì ì…ë‹ˆë‹¤.",
      C: "ì²´ê³„ì ì´ê³  ì±…ì„ê° ìˆê²Œ ê³„íšì„ ì‹¤ì²œí•˜ëŠ” ìœ í˜•ì…ë‹ˆë‹¤."
    },
    labels: {E:"ì™¸í–¥ì„± ğŸ’¬", S:"ì•ˆì •ì„± âš–ï¸", O:"ê°œë°©ì„± ğŸ’¡", C:"ì„±ì‹¤ì„± ğŸ“˜"},
    ttsIntro: "í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì§ˆë¬¸ì„ ì˜ ë“£ê³  ë‹µí•´ì£¼ì„¸ìš”.",
    ttsFinish: "ê²°ê³¼ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜í”„ì™€ ì„¤ëª…ì„ í™•ì¸í•˜ì„¸ìš”."
  },

  en: {
    title: "Personality Test â€” E/S/O/C",
    intro: "Answer questions to analyze E/S/O/C traits.",
    start: "Start", retry: "Retry",
    questions: [
      { q:"When friends plan a weekend, how do you react?", c:[["I volunteer to join","E"],["I observe quietly","S"],["I suggest something new","O"],["I check the schedule first","C"]] },
      { q:"When with strangers, what do you do?", c:[["I start conversations","E"],["I speak only when needed","S"],["I bring up new topics","O"],["I observe reactions first","C"]] },
      { q:"How do you begin a new task?", c:[["I collaborate with others","E"],["I plan carefully","C"],["I try things creatively","O"],["I study guidelines then start","S"]] },
      { q:"What matters most when preparing a trip?", c:[["Fun for everyone","E"],["Comfortable lodging","S"],["New experiences","O"],["Detailed planning","C"]] },
      { q:"When opinions split, how do you act?", c:[["I mediate and lead","E"],["I calmly assess","S"],["I propose creative fixes","O"],["I present logical reasons","C"]] }
    ],
    traits: {
      E: "You gain energy from social interaction and enjoy being around people.",
      S: "You prefer calm, steady approaches and value balance.",
      O: "You enjoy novelty, creativity, and exploring new ideas.",
      C: "You are organized, responsible, and plan-oriented."
    },
    labels: {E:"Extrovert ğŸ’¬", S:"Stable âš–ï¸", O:"Open ğŸ’¡", C:"Conscientious ğŸ“˜"},
    ttsIntro: "Starting the test. Please listen to the questions and answer.",
    ttsFinish: "Your results are ready. Check the chart and descriptions."
  },

  ja: {
    title: "å¿ƒç†ãƒ†ã‚¹ãƒˆ â€” E/S/O/C",
    intro: "ã„ãã¤ã‹ã®è³ªå•ã«ç­”ãˆã¦ã€å‚¾å‘ã‚’åˆ†æã—ã¾ã™ã€‚",
    start: "é–‹å§‹", retry: "ã‚‚ã†ä¸€åº¦",
    questions: [
      { q:"å‹é”ãŒé€±æœ«ã®äºˆå®šã‚’ç«‹ã¦ã‚‹ã¨ãã€ã‚ãªãŸã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ", c:[["å‚åŠ ã‚’è¡¨æ˜ã™ã‚‹","E"],["é™ã‹ã«æ§˜å­ã‚’è¦‹ã‚‹","S"],["æ–°ã—ã„æ¡ˆã‚’ææ¡ˆã™ã‚‹","O"],["äºˆå®šã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ±ºã‚ã‚‹","C"]] },
      { q:"çŸ¥ã‚‰ãªã„äººã¨ã„ã‚‹ã¨ãã€ã‚ãªãŸã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ", c:[["è‡ªåˆ†ã‹ã‚‰è©±ã™","E"],["å¿…è¦ãªã¨ãã ã‘è©±ã™","S"],["æ–°ã—ã„è©±é¡Œã‚’å‡ºã™","O"],["ç›¸æ‰‹ã®åå¿œã‚’è¦‹ã‚‹","C"]] },
      { q:"æ–°ã—ã„ä»•äº‹ã‚’ä»»ã•ã‚ŒãŸã‚‰ã€ã©ã†å§‹ã‚ã¾ã™ã‹ï¼Ÿ", c:[["å”åŠ›ã—ã¦é€²ã‚ã‚‹","E"],["è¨ˆç”»ã‚’ç«‹ã¦ã‚‹","C"],["è©¦ã—ã¦å­¦ã¶","O"],["æŒ‡ç¤ºã‚’ç¢ºèªã—ã¦ã‹ã‚‰å§‹ã‚ã‚‹","S"]] },
      { q:"æ—…è¡Œæº–å‚™ã§ä¸€ç•ªé‡è¦–ã™ã‚‹ã®ã¯ï¼Ÿ", c:[["ã¿ã‚“ãªãŒæ¥½ã—ã‚ã‚‹ã“ã¨","E"],["å¿«é©ãªå®¿æ³Š","S"],["æ–°ã—ã„ä½“é¨“","O"],["è©³ç´°ãªè¨ˆç”»","C"]] },
      { q:"æ„è¦‹ãŒåˆ†ã‹ã‚ŒãŸã¨ãã€ã‚ãªãŸã¯ï¼Ÿ", c:[["ã¾ã¨ã‚å½¹ã«ãªã‚‹","E"],["å†·é™ã«åˆ¤æ–­ã™ã‚‹","S"],["å‰µé€ çš„ãªææ¡ˆã‚’ã™ã‚‹","O"],["è«–ç†çš„ã«èª¬æ˜ã™ã‚‹","C"]] }
    ],
    traits: {
      E: "äººã¨ã®äº¤æµã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å¾—ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚",
      S: "è½ã¡ç€ãã¨å®‰å®šã‚’å¥½ã‚€æ…é‡ãªã‚¿ã‚¤ãƒ—ã§ã™ã€‚",
      O: "æ–°ã—ã„ä½“é¨“ã‚„å‰µé€ çš„ãªã“ã¨ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã§ã™ã€‚",
      C: "è¨ˆç”»çš„ã§è²¬ä»»æ„ŸãŒå¼·ã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚"
    },
    labels: {E:"å¤–å‘å‹ ğŸ’¬", S:"å®‰å®šå‹ âš–ï¸", O:"é–‹æ”¾å‹ ğŸ’¡", C:"èª å®Ÿå‹ ğŸ“˜"},
    ttsIntro: "ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚è³ªå•ã‚’èã„ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚",
    ttsFinish: "çµæœãŒå‡ºã¾ã—ãŸã€‚ãƒãƒ£ãƒ¼ãƒˆã¨èª¬æ˜ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
  },

  fr: {
    title: "Test de personnalitÃ© â€” E/S/O/C",
    intro: "RÃ©pondez aux questions pour analyser vos traits E/S/O/C.",
    start: "Commencer", retry: "Recommencer",
    questions: [
      { q:"Quand des amis planifient un week-end, comment rÃ©agissez-vous ?", c:[["Je me porte volontaire","E"],["J'observe tranquillement","S"],["Je propose quelque chose de nouveau","O"],["Je vÃ©rifie l'emploi du temps","C"]] },
      { q:"Avec des inconnus, que faites-vous ?", c:[["Je commence la conversation","E"],["Je parle si nÃ©cessaire","S"],["Je propose de nouveaux sujets","O"],["J'observe les rÃ©actions","C"]] },
      { q:"Comment commencez-vous une nouvelle tÃ¢che ?", c:[["Je collabore","E"],["Je planifie","C"],["J'essaie de maniÃ¨re crÃ©ative","O"],["Je lis les instructions","S"]] },
      { q:"Lors de la prÃ©paration d'un voyage, qu'est-ce qui compte le plus ?", c:[["Un itinÃ©raire apprÃ©ciÃ© de tous","E"],["Un hÃ©bergement confortable","S"],["De nouvelles expÃ©riences","O"],["Un planning dÃ©taillÃ©","C"]] },
      { q:"Si les opinions divergent, que faites-vous ?", c:[["Je mÃ©die et guide","E"],["J'observe calmement","S"],["Je propose des solutions crÃ©atives","O"],["J'apporte des arguments logiques","C"]] }
    ],
    traits: {
      E: "Vous vous ressourÃ§ez par les interactions sociales et aimez Ãªtre avec les autres.",
      S: "Vous privilÃ©giez la stabilitÃ©, le calme et la prise de dÃ©cision Ã©quilibrÃ©e.",
      O: "Vous aimez la nouveautÃ© et les idÃ©es crÃ©atives.",
      C: "Vous Ãªtes organisÃ©, responsable et axÃ© sur les objectifs."
    },
    labels: {E:"Extraverti ğŸ’¬", S:"Stable âš–ï¸", O:"Ouvert ğŸ’¡", C:"Consciencieux ğŸ“˜"},
    ttsIntro: "DÃ©marrage du test. Ã‰coutez les questions et rÃ©pondez.",
    ttsFinish: "Les rÃ©sultats sont prÃªts. Consultez le graphique et les explications."
  },

  es: {
    title: "Test de personalidad â€” E/S/O/C",
    intro: "Responde preguntas para analizar tus rasgos E/S/O/C.",
    start: "Comenzar", retry: "Reintentar",
    questions: [
      { q:"Cuando amigos planean el fin de semana, Â¿cÃ³mo reaccionas?", c:[["Me ofrezco para participar","E"],["Observo en silencio","S"],["Propongo algo nuevo","O"],["Reviso el horario primero","C"]] },
      { q:"Con desconocidos, Â¿quÃ© haces?", c:[["Inicio la conversaciÃ³n","E"],["Hablo si es necesario","S"],["Propongo nuevos temas","O"],["Observo las reacciones","C"]] },
      { q:"Â¿CÃ³mo empiezas una nueva tarea?", c:[["Colaboro con otros","E"],["Planifico","C"],["Pruebo creativamente","O"],["Sigo las instrucciones","S"]] },
      { q:"Al preparar un viaje, Â¿quÃ© importa mÃ¡s?", c:[["DiversiÃ³n para todos","E"],["Alojamiento cÃ³modo","S"],["Nuevas experiencias","O"],["Plan detallado","C"]] },
      { q:"Si hay desacuerdo, Â¿quÃ© haces?", c:[["Medio y guÃ­o","E"],["EvalÃºo con calma","S"],["Propongo soluciones creativas","O"],["Presento argumentos lÃ³gicos","C"]] }
    ],
    traits: {
      E: "Te energizas con la interacciÃ³n social y disfrutas estar con la gente.",
      S: "Prefieres calma, estabilidad y decisiones equilibradas.",
      O: "Disfrutas la novedad, la creatividad y nuevas experiencias.",
      C: "Eres organizado, responsable y orientado a objetivos."
    },
    labels: {E:"Extrovertido ğŸ’¬", S:"Estable âš–ï¸", O:"Abierto ğŸ’¡", C:"Concienzudo ğŸ“˜"},
    ttsIntro: "Iniciando la prueba. Escucha las preguntas y responde.",
    ttsFinish: "Tus resultados estÃ¡n listos. Revisa el grÃ¡fico y las descripciones."
  },

  zh: {
    title: "äººæ ¼æµ‹è¯• â€” E/S/O/C",
    intro: "å›ç­”é—®é¢˜ä»¥åˆ†ææ‚¨çš„ E/S/O/C æ€§æ ¼ç‰¹å¾ã€‚",
    start: "å¼€å§‹", retry: "é‡è¯•",
    questions: [
      { q:"å½“æœ‹å‹è®¡åˆ’å‘¨æœ«æ´»åŠ¨æ—¶ï¼Œä½ é€šå¸¸å¦‚ä½•ååº”ï¼Ÿ", c:[["ä¸»åŠ¨å‚ä¸","E"],["é™é™è§‚å¯Ÿ","S"],["æå‡ºæ–°å»ºè®®","O"],["å…ˆçœ‹æ—¥ç¨‹å®‰æ’","C"]] },
      { q:"ä¸é™Œç”Ÿäººåœ¨ä¸€èµ·æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ", c:[["ä¸»åŠ¨æ­è¯","E"],["åªåœ¨å¿…è¦æ—¶è¯´è¯","S"],["æå‡ºæ–°è¯é¢˜","O"],["å…ˆè§‚å¯Ÿååº”","C"]] },
      { q:"å¼€å§‹ä¸€é¡¹æ–°ä»»åŠ¡æ—¶ï¼Œä½ æ€æ ·åšï¼Ÿ", c:[["ä¸ä»–äººåä½œ","E"],["å…ˆè®¡åˆ’å†åš","C"],["åˆ›é€ æ€§å°è¯•","O"],["å…ˆç†Ÿæ‚‰è¯´æ˜å†åš","S"]] },
      { q:"å‡†å¤‡æ—…è¡Œæ—¶ï¼Œä½ æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿ", c:[["å¤§å®¶éƒ½èƒ½äº«å—çš„è¡Œç¨‹","E"],["èˆ’é€‚ç¨³å®šçš„ä½å®¿","S"],["æ–°çš„ä½“éªŒ","O"],["è¯¦ç»†è®¡åˆ’","C"]] },
      { q:"å½“æ„è§åˆ†æ­§æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ", c:[["åè°ƒå¹¶å¼•å¯¼","E"],["å†·é™è¯„ä¼°","S"],["æå‡ºåˆ›é€ æ€§æ–¹æ¡ˆ","O"],["ç”¨é€»è¾‘è¯´æ˜è§‚ç‚¹","C"]] }
    ],
    traits: {
      E: "é€šè¿‡ç¤¾äº¤äº’åŠ¨è·å¾—èƒ½é‡ï¼Œå–œæ¬¢ä¸äººç›¸å¤„ã€‚",
      S: "é‡è§†ç¨³å®šä¸è°¨æ…ï¼Œåå¥½å¹³ç¨³çš„é€‰æ‹©ã€‚",
      O: "å–œæ¬¢æ–°å¥‡ä¸åˆ›æ„ï¼Œä¹äºå°è¯•æ–°ä½“éªŒã€‚",
      C: "æœ‰è´£ä»»æ„Ÿä¸”æœ‰æ¡ç†ï¼Œæ³¨é‡è®¡åˆ’ä¸æ‰§è¡Œã€‚"
    },
    labels: {E:"å¤–å‘ ğŸ’¬", S:"ç¨³å®š âš–ï¸", O:"å¼€æ”¾ ğŸ’¡", C:"å°½è´£ ğŸ“˜"},
    ttsIntro: "å¼€å§‹æµ‹è¯•ï¼Œè¯·å¬é¢˜å¹¶å›ç­”ã€‚",
    ttsFinish: "æµ‹è¯•å®Œæˆï¼ŒæŸ¥çœ‹å›¾è¡¨ä¸è¯´æ˜ã€‚"
  }
};

/* ======================
   ìƒíƒœê°’ & DOM ì°¸ì¡°
   ====================== */
let lang = 'ko';
let questions = [], selected = [], qIndex = 0;
let scores = {E:0,S:0,O:0,C:0};
let chartInstance = null;

const langSelect = document.getElementById('langSelect');
const startBtn = document.getElementById('startBtn');
const headerControls = document.getElementById('headerControls');
const introText = document.getElementById('introText');
const startBox = document.getElementById('startBox');
const questionCard = document.getElementById('questionCard');
const questionTitle = document.getElementById('questionTitle');
const choicesDiv = document.getElementById('choices');
const progressFill = document.getElementById('progressFill');
const resultCard = document.getElementById('resultCard');
const resultTitle = document.getElementById('resultTitle');
const resultSummary = document.getElementById('resultSummary');
const traitDetails = document.getElementById('traitDetails');
const resultChartCanvas = document.getElementById('resultChart');

/* ======================
   ì´ˆê¸°í™”: ì–¸ì–´ ì˜µì…˜ ì±„ìš°ê¸°, ìë™ê°ì§€
   ====================== */
function initLanguages(){
  langSelect.innerHTML = Object.keys(DATA).map(k=>{
    const label = {ko:'í•œêµ­ì–´', en:'English', ja:'æ—¥æœ¬èª', fr:'FranÃ§ais', es:'EspaÃ±ol', zh:'ä¸­æ–‡'}[k] || k;
    return `<option value="${k}">${label}</option>`;
  }).join('');
  // ìë™ ê°ì§€ (ë¸Œë¼ìš°ì € ì–¸ì–´)
  const userLang = navigator.language ? navigator.language.slice(0,2) : 'ko';
  if(DATA[userLang]) lang = userLang;
  langSelect.value = lang;
  applyTexts();
}
function applyTexts(){
  const d = DATA[lang];
  document.getElementById('appTitle').innerText = d.title;
  introText.innerText = d.intro;
  startBtn.innerText = d.start;
  // result labels initially
  resultTitle.innerText = d.labels ? Object.values(d.labels).join(' Â· ') : 'Result';
}
langSelect.addEventListener('change', e => { lang = e.target.value; applyTexts(); });

/* ======================
   ì‹œì‘ / í€´ì¦ˆ ë¡œì§
   ====================== */
startBtn.addEventListener('click', startQuiz);

function startQuiz(){
  // ìˆ¨ê¸°ê¸°: ì–¸ì–´ ì„ íƒ ë° ì‹œì‘ ë²„íŠ¼
  headerControls.style.display = 'none';
  // ì´ˆê¸°í™”
  questions = DATA[lang].questions.slice();
  selected = shuffle(questions).slice(0,5); // 5ë¬¸í•­ ëœë¤
  qIndex = 0;
  scores = {E:0,S:0,O:0,C:0};
  // ë·° í† ê¸€
  startBox.style.display = 'none';
  questionCard.style.display = 'block';
  resultCard.style.display = 'none';
  progressFill.style.width = '0%';
  // TTS: intro
  speak(DATA[lang].ttsIntro);
  showQuestion();
}

function showQuestion(){
  const q = selected[qIndex];
  questionTitle.innerText = `(${qIndex+1}/${selected.length}) ${q.q}`;
  choicesDiv.innerHTML = '';
  // ë¬´ì‘ìœ„ë¡œ ì„ íƒì§€ ì…”í”Œ
  const shuffled = shuffle(q.c);
  shuffled.forEach(([txt, trait], idx) => {
    const el = document.createElement('div');
    el.className = 'choice';
    el.tabIndex = 0;
    el.innerText = txt;
    el.onclick = () => selectChoice(el, trait);
    el.onkeydown = (e) => { if(e.key === 'Enter' || e.key === ' ') selectChoice(el, trait); };
    choicesDiv.appendChild(el);
  });
  progressFill.style.width = `${(qIndex / selected.length) * 100}%`;
  // TTS: ì§ˆë¬¸ ì½ê¸°
  speak(q.q);
}

function selectChoice(el, trait){
  // ì‹œê°ì  ì„ íƒíš¨ê³¼
  Array.from(choicesDiv.children).forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  // ì ê¹ ëŒ€ê¸° í›„ ë‹¤ìŒ
  setTimeout(()=>{
    scores[trait] = (scores[trait] || 0) + 1;
    qIndex++;
    if(qIndex < selected.length) showQuestion();
    else finishQuiz();
  }, 220);
}

/* ======================
   ê²°ê³¼ ì²˜ë¦¬ & ì‹œê°í™”
   ====================== */
function finishQuiz(){
  questionCard.style.display = 'none';
  resultCard.style.display = 'block';
  progressFill.style.width = '100%';
  const d = DATA[lang];
  // ì •ë ¬ ë° ìƒìœ„ ì„±í–¥ ì¶”ì¶œ
  const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
  const top3 = sorted.slice(0,3).map(s=>s[0]).join('');
  const topMain = sorted[0][0];
  resultTitle.innerText = d.labels[topMain] || topMain;
  resultSummary.innerText = `${d.traits[topMain] || ''} (${top3})`;
  // ì„¸ë¶€ í•­ëª©(ë„¤ ì„±í–¥ ëª¨ë‘)
  traitDetails.innerHTML = Object.entries(d.traits).map(([k,v])=>{
    const icon = {E:'ğŸ’¬',S:'âš–ï¸',O:'ğŸ’¡',C:'ğŸ“˜'}[k];
    const val = scores[k] || 0;
    return `<div style="margin:6px 0;padding:8px;border-radius:8px;background:#f8fafc">${icon} <strong>${k}</strong> â€” ${v} <span style="float:right;font-weight:700">${val}</span></div>`;
  }).join('');
  // ì°¨íŠ¸
  renderChart();
  // TTS: ê²°ê³¼ ì•ˆë‚´
  speak(DATA[lang].ttsFinish + ' ' + (d.traits[topMain] || ''));
}

/* ======================
   Chart ë Œë”ë§
   ====================== */
function renderChart(){
  const labels = ['E','S','O','C'];
  const dataValues = labels.map(l => scores[l] || 0);
  const ctx = resultChartCanvas.getContext('2d');
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels.map(l => `${l} ${({E:'ğŸ’¬',S:'âš–ï¸',O:'ğŸ’¡',C:'ğŸ“˜'})[l]}`),
      datasets: [{
        label: DATA[lang].labels ? (DATA[lang].labels.E ? 'You' : 'You') : 'You',
        data: dataValues,
        backgroundColor: 'rgba(99,102,241,0.18)',
        borderColor: '#6366f1',
        pointBackgroundColor: '#6366f1',
        pointRadius:6
      }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      scales: { r: { suggestedMin:0, suggestedMax:5, ticks:{stepSize:1} } },
      plugins:{legend:{display:false}}
    }
  });
}

/* ======================
   TTS ìœ í‹¸ (ì–¸ì–´ ë§¤í•‘ ë° ì•ˆì „ì²˜ë¦¬)
   ====================== */
const ttsMap = { ko:'ko-KR', en:'en-US', ja:'ja-JP', fr:'fr-FR', es:'es-ES', zh:'zh-CN' };
function speak(text){
  if(!('speechSynthesis' in window) || !text) return;
  try{
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = ttsMap[lang] || 'en-US';
    u.rate = 1;
    u.pitch = 1;
    window.speechSynthesis.speak(u);
  }catch(e){
    console.warn('TTS error', e);
  }
}

/* ======================
   ìœ í‹¸: shuffle
   ====================== */
function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }

/* ======================
   init
   ====================== */
initLanguages();

// Restart ë²„íŠ¼: ë‹¨ìˆœíˆ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì´ˆê¸° ìƒíƒœ ë³µêµ¬
document.getElementById('restartBtn').addEventListener('click', ()=>{
  // ìŒì„± ì·¨ì†Œ
  if('speechSynthesis' in window) window.speechSynthesis.cancel();
  // ì¬ì‹œì‘: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì–¸ì–´ ì„ íƒì°½ ë‹¤ì‹œ ë³´ì´ê²Œ)
  location.reload();
});
</script>
</body>
</html>
