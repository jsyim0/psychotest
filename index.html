<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ â€” E/S/O/C (ë‹¤êµ­ì–´ + TTS)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --accent:#6366f1;
    --bg:linear-gradient(120deg,#eef2ff,#e0e7ff);
    --card:#fff;
    --maxw:980px;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, "Noto Sans KR", system-ui; margin:0; padding:20px; display:flex; justify-content:center; background:var(--bg)}
  .card{width:100%;max-width:var(--maxw);background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:1.2rem;background:linear-gradient(45deg,#4f46e5,#8b5cf6);-webkit-background-clip:text;color:transparent}
  #headerControls{display:flex;gap:8px;align-items:center}
  select,input,button{font-size:0.95rem;padding:8px 10px;border-radius:8px;border:1px solid #e6e9f2;background:transparent}
  button.btn{background:var(--accent);color:#fff;border:none;cursor:pointer;box-shadow:0 6px 18px rgba(99,102,241,0.12)}
  main{display:flex;gap:16px;flex-wrap:wrap}
  .quiz{flex:1 1 420px;min-width:280px}
  .start-box,.question-card,.result-card{border-radius:12px;padding:14px;background:rgba(255,255,255,0.98);box-shadow:0 6px 18px rgba(2,6,23,0.04)}
  .intro{color:#475569;margin:6px 0 12px;font-size:0.95rem;line-height:1.4}
  .trait-cards{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
  .trait{border-radius:10px;padding:10px;text-align:center;font-size:0.9rem}
  .E{background:#eff6ff;color:#1d4ed8} .S{background:#f0fdf4;color:#15803d}
  .O{background:#fff7ed;color:#c2410c} .C{background:#f5f3ff;color:#6d28d9}
  .progress{height:10px;background:#eef2ff;border-radius:999px;overflow:hidden;margin:10px 0}
  .progress > .fill{height:100%;width:0;background:linear-gradient(90deg,#6366f1,#8b5cf6);transition:width .3s}
  .choices{display:flex;flex-direction:column;gap:10px;margin-top:8px}
  .choice{padding:12px;border-radius:10px;background:#f8fafc;cursor:pointer;border:1px solid transparent;transition:all .15s}
  .choice:hover{transform:translateY(-3px);background:#eef2ff;border-color:rgba(99,102,241,0.12)}
  .visual{width:360px;flex:0 0 360px;min-width:260px;display:flex;flex-direction:column;gap:12px}
  .chart-wrap{border-radius:12px;padding:12px;background:rgba(255,255,255,0.98);height:360px;display:flex;flex-direction:column;
              opacity:0; pointer-events:none; transition:opacity .5s ease;} /* âœ… ì´ˆê¸° ìˆ¨ê¹€ ìƒíƒœ */
  .chart-wrap.visible{opacity:1; pointer-events:auto;} /* âœ… ê²°ê³¼ ì‹œì ì— ë³´ì´ë„ë¡ */
  .small{font-size:0.9rem;color:#64748b}
  @media(max-width:980px){main{flex-direction:column-reverse}.visual{width:100%}}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="ì‹¬ë¦¬í…ŒìŠ¤íŠ¸">
    <header>
      <h1 id="appTitle">ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ â€” E/S/O/C</h1>
      <div id="headerControls">
        <select id="langSelect" aria-label="ì–¸ì–´ ì„ íƒ"></select>
        <button class="btn" id="startBtn">ì‹œì‘</button>
      </div>
    </header>

    <main>
      <!-- quiz column -->
      <section class="quiz" aria-live="polite">
        <div id="startBox" class="start-box">
          <p id="introText" class="intro">ì–¸ì–´ë¥¼ ì„ íƒí•œ ë’¤ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”. ì‹œì‘í•˜ë©´ ì–¸ì–´ ì„ íƒê³¼ ì‹œì‘ ë²„íŠ¼ì€ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.</p>
          <div class="trait-cards" role="list">
            <div class="trait E" role="listitem">ğŸ’¬ <strong>E â€” ì™¸í–¥ì„±</strong><div class="small">ì‚¬ëŒë“¤ê³¼ ì–´ìš¸ë¦¬ë©° ì—ë„ˆì§€ë¥¼ ì–»ëŠ” íƒ€ì…</div></div>
            <div class="trait S" role="listitem">âš–ï¸ <strong>S â€” ì•ˆì •ì„±</strong><div class="small">ì°¨ë¶„í•˜ê³  ê· í˜•ì„ ì¤‘ì‹œí•˜ëŠ” íƒ€ì…</div></div>
            <div class="trait O" role="listitem">ğŸ’¡ <strong>O â€” ê°œë°©ì„±</strong><div class="small">ìƒˆë¡­ê³  ì°½ì˜ì ì¸ ê²ƒì„ ì¦ê¸°ëŠ” íƒ€ì…</div></div>
            <div class="trait C" role="listitem">ğŸ“˜ <strong>C â€” ì„±ì‹¤ì„±</strong><div class="small">ê³„íšì ì´ê³  ì±…ì„ê° ìˆëŠ” íƒ€ì…</div></div>
          </div>
        </div>

        <div id="questionCard" class="question-card" style="display:none; margin-top:12px;">
          <div class="progress"><div class="fill" id="progressFill"></div></div>
          <div id="questionTitle" class="question-title" style="font-weight:700"></div>
          <div class="choices" id="choices" role="list"></div>
        </div>

        <div id="resultCard" class="result-card" style="display:none; margin-top:12px;">
          <h3 id="resultTitle">ê²°ê³¼</h3>
          <p id="resultSummary" class="small"></p>
          <div id="traitDetails" style="margin-top:8px"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn" id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
          </div>
        </div>
      </section>

      <!-- visualization column -->
      <aside class="visual" aria-hidden="false">
        <div class="chart-wrap" id="chartWrap">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div class="small" id="chartTitle">ì°¨íŠ¸ (ë ˆì´ë”)</div>
            <div class="small" id="chartHint">ê²°ê³¼ í›„ ìë™ í‘œì‹œ</div>
          </div>
          <div style="flex:1;position:relative;margin-top:8px;">
            <canvas id="resultChart" role="img" aria-label="ê²°ê³¼ ì°¨íŠ¸" style="width:100%;height:100%"></canvas>
          </div>
        </div>
        <div class="small" style="text-align:center">ì•„ì´ì½˜: ğŸ’¬ E Â· âš–ï¸ S Â· ğŸ’¡ O Â· ğŸ“˜ C</div>
      </aside>
    </main>
  </div>

<script>
/* ... (ì¤‘ëµ: DATA, TTS, shuffle ë“±ì€ ë™ì¼) ... */

const chartWrap = document.getElementById('chartWrap'); // âœ… chartWrap ì°¸ì¡° ì¶”ê°€

function startQuiz(){
  headerControls.style.display = 'none';
  startBox.style.display = 'none';
  questionCard.style.display = 'block';
  resultCard.style.display = 'none';
  chartWrap.classList.remove('visible'); // âœ… ì‹œì‘ ì‹œ ì°¨íŠ¸ ìˆ¨ê¹€
  progressFill.style.width = '0%';
  questions = DATA[lang].questions.slice();
  selected = shuffle(questions).slice(0,5);
  qIndex = 0;
  scores = {E:0,S:0,O:0,C:0};
  speak(DATA[lang].ttsIntro);
  showQuestion();
}

function finishQuiz(){
  questionCard.style.display = 'none';
  resultCard.style.display = 'block';
  progressFill.style.width = '100%';
  const d = DATA[lang];
  const sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
  const topMain = sorted[0][0];
  const top3 = sorted.slice(0,3).map(s=>s[0]).join('');
  resultTitle.innerText = d.labels[topMain] || topMain;
  resultSummary.innerText = `${d.traits[topMain] || ''} (${top3})`;
  traitDetails.innerHTML = Object.entries(d.traits).map(([k,v])=>{
    const icon = {E:'ğŸ’¬',S:'âš–ï¸',O:'ğŸ’¡',C:'ğŸ“˜'}[k];
    return `<div style="margin:6px 0;padding:8px;border-radius:8px;background:#f8fafc">${icon} <strong>${k}</strong> â€” ${v} <span style="float:right;font-weight:700">${scores[k]}</span></div>`;
  }).join('');
  renderChart();
  chartWrap.classList.add('visible'); // âœ… ê²°ê³¼ í›„ ì°¨íŠ¸ í‘œì‹œ
  speak(d.ttsFinish + ' ' + (d.traits[topMain] || ''));
}

document.getElementById('restartBtn').addEventListener('click', ()=>{
  if('speechSynthesis' in window) window.speechSynthesis.cancel();
  chartWrap.classList.remove('visible'); // âœ… ë‹¤ì‹œ ì‹œì‘ ì‹œ ì°¨íŠ¸ ìˆ¨ê¹€
  location.reload();
});
</script>
</body>
</html>
